#!/bin/sh

#
# Install git
#

printf "Escalated privileges are required, type in either 'doas' or 'sudo' to continue.\nSelection: "

while opt=$(line)
  do
    case $opt in
      "doas" )
        ESCALATE=${CH_SUDO:-doas}
        export ESCALATE
        break
      ;;
      "sudo" )
        ESCALATE=${CH_SUDO:-sudo}
        export ESCALATE
        break
      ;;
      *)
        echo "'$REPLY' is an invalid option!"
      ;;
  esac
done

#TODO: Laziness; using a switch case would improve script performance.
if [ -x "$(command -v emerge)" ] && [ ! -x "$(command -v git)" ]; then
  $ESCALATE emerge -U dev-vcs/git
elif [ -x "$(command -v pacman)" ] && [ ! -x "$(command -v git)" ]; then
  $ESCALATE pacman -S --needed --noconfirm git
elif [ -x "$(command -v apt)" ] && [ ! -x "$(command -v git)" ]; then
  $ESCALATE apt install git -y
elif [ -x "$(command -v dnf)" ] && [ ! -x "$(command -v git)" ]; then
  $ESCALATE dnf install -y git
fi

#
# Clone cathook
#

git clone --depth 1 https://github.com/nullworks/cathook.git

#
# Run cathook's install all script
#

if [ -d "${PWD}/cathook" ]
  then
    cd "${PWD}/cathook" || exit
    bash ./install-all
  else
    mkdir -p "${PWD}/cathook"
    cd "${PWD}/cathook" || exit
    bash ./install-all
fi
