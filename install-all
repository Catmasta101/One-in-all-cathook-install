#!/bin/sh

#
# Install git
#

printf "Escalated privileges are required, type in either 'doas' or 'sudo' to continue.\nSelection: "

while opt=$(line)
  do
    case $opt in
      "doas" )
        ESCALATE=doas
        export ESCALATE
        break
      ;;
      "sudo" )
        ESCALATE=sudo
        export ESCALATE
        break
      ;;
      *)
        echo "'$REPLY' is an invalid option!"
      ;;
  esac
done

case "$DISTRO" in
  "-x $(command -v emerge) && ! -x $(command -v git)")
    $ESCALATE emerge dev-vcs/git
  ;;
  "-x $(command -v pacman) && ! -x $(command -v git)")
    $ESCALATE pacman -S --needed --noconfirm git
  ;;
  "-x $(command -v apt) && ! -x $(command -v git)")
    $ESCALATE apt install git -y
  ;;
esac

#
# Clone cathook
#

git clone --depth 1 https://github.com/nullworks/cathook.git

#
# Run cathook's install all script
#

if [ -d "${PWD}/cathook" ]
  then
    cd "${PWD}/cathook" || exit
    sh ./install-all
  else
    mkdir -p "${PWD}/cathook"
    cd "${PWD}/cathook" || exit
    sh ./install-all
fi
